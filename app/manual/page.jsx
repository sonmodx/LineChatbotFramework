"use client";
import React, { useState, useRef, useEffect } from "react";
import { Box, Typography, Container, List, ListItem, ListItemText, Grid, Card, CardContent, Button } from "@mui/material";
import { Info as InfoIcon } from "@mui/icons-material";

const Manual = () => {
  const [expandedIndex, setExpandedIndex] = useState(null);
  const [contentHeight, setContentHeight] = useState([]);
  const contentRefs = useRef([]);

  useEffect(() => {
    // Recalculate heights only after content has been updated
    const heights = contentRefs.current.map((ref) => ref?.scrollHeight || 0);
    setContentHeight(heights);
  }, [expandedIndex]); // Recalculate heights when the expandedIndex changes

const sections = [
  {
    title: "ภาพรวม",
    content:
      "คู่มือฉบับนี้จะช่วยให้คุณตั้งค่าและจัดการแชทบอทบน Line ด้วย middleware ได้อย่างง่ายดาย โดยครอบคลุมทั้งส่วนของผู้ดูแลระบบและผู้ใช้งานทั่วไป รวมถึงวิธีตั้งค่าบอทประเภทต่าง ๆ และกำหนดข้อความตอบกลับ",
  },
  {
    title: "เข้าสู่ระบบ / ลงทะเบียน",
    content: "คุณสามารถเข้าสู่ระบบหรือสมัครสมาชิกได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
    steps: [
      "เปิดหน้าล็อกอินหรือหน้าลงทะเบียน",
      "กรอกอีเมลและรหัสผ่าน (สำหรับเข้าสู่ระบบ) หรือกรอกข้อมูลที่จำเป็น (สำหรับสมัครสมาชิก)",
      "คลิกปุ่มเข้าสู่ระบบหรือลงทะเบียน",
      "หากสำเร็จ จะพาคุณไปยังหน้าหลัก",
      "หากข้อมูลผิด ระบบจะแจ้งเตือนให้ลองใหม่",
    ],
    tips: [
      "ตรวจสอบอีเมลและรหัสผ่านให้ถูกต้อง",
      "ตั้งรหัสผ่านให้ปลอดภัย เช่น ตัวเลข + ตัวอักษรพิเศษ",
      "หากลืมรหัสผ่าน ให้ใช้ตัวเลือก \"ลืมรหัสผ่าน\"",
      "ตรวจสอบอีเมลเพื่อยืนยันตัวตน (หากระบบร้องขอ)",
    ],
  },
  {
    title: "สร้างแชทบอท",
    content: "เชื่อมบอทเข้ากับ Line developer ได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
    steps: [
      "ไปที่เมนูจัดการแชทบอท",
      "กดปุ่ม \"สร้างแชทบอท\"",
      "กรอกข้อมูลช่องทาง: ชื่อ, Channel Secret, Channel Access Token",
      "กดบันทึก",
    ],
    tips: [
      "ตรวจสอบ Token และ Secret ให้ถูกต้องก่อนบันทึก",
      "ตั้งชื่อให้สื่อความหมายเพื่อให้ง่ายต่อการจัดการ",
    ],
  },
  {
    title: "ตั้งค่าบอท และ แก้ไขข้อความ",
    content: "ในส่วนนี้คุณสามารถตั้งค่าบอทและกำหนดข้อความตอบกลับที่เหมาะสมกับการใช้งานได้:",
    steps: [
      "เลือกแชทบอทที่ต้องการตั้งค่า",
      "กำหนดประเภท: ข้อความ, ปฏิกิริยา, API บอท",
      "กำหนดพฤติกรรม เช่น ตอบกลับอัตโนมัติ, รูปแบบข้อความ",
      "เพิ่มเงื่อนไขการตอบกลับ เช่น คำหลัก",
      "บันทึกการตั้งค่า",
    ],
    tips: [
      "ทดสอบการตั้งค่าก่อนใช้งานจริง",
      "ใช้คำหลักให้ชัดเจนเพื่อให้การตอบกลับถูกต้อง",
    ],
  },
  {
    title: "ตั้งค่าเมนู Rich Menu",
    content: "คุณสามารถสร้าง Rich Menu ได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
    steps: [
      "ไปที่แท็บ Rich Menu ในแชทบอทที่เลือก",
      "อัปโหลดภาพเมนู (ขนาดแนะนำ: 1200x810 px)",
      "กำหนดปุ่มกด เช่น ลิงก์, คำสั่งตอบกลับ",
      "กดบันทึก",
    ],
    tips: [
      "ใช้เมนูที่เข้าใจง่ายและชัดเจน",
      "เพิ่มปุ่มโต้ตอบเพื่อเพิ่มการมีส่วนร่วม",
    ],
  },
  {
    title: "ส่งข้อความ",
    content: "คุณสามารถส่งข้อความต่างๆได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
    steps: [
      "ไปที่เมนูส่งข้อความ",
      "เลือกประเภทข้อความ: ข้อความทั่วไป, Broadcast, Narrowcast",
      "กรอกเนื้อหาข้อความ",
      "กดส่ง",
    ],
  },
  {
    title: "การดู Log (บันทึกเหตุการณ์)",
    content:
      "ฟีเจอร์ Log (บันทึกเหตุการณ์) ช่วยให้คุณติดตามและตรวจสอบการกระทำต่าง ๆ ของแชทบอท เช่น การตั้งค่าบอท, การส่งข้อความ และเหตุการณ์สำคัญอื่น ๆ ที่เกิดขึ้นในระบบ",
    steps: [
      "ไปที่เมนู **บันทึกเหตุการณ์ (Log)** ในแถบเมนู",
      "ในหน้านี้คุณจะเห็นบันทึกเหตุการณ์ทั้งหมดในระบบ เช่น ข้อความที่ถูกส่ง, การตั้งค่าบอทที่มีการแก้ไข หรือเหตุการณ์สำคัญต่าง ๆ",
      "คุณสามารถคลิกเพื่อดูรายละเอียดของเหตุการณ์ในแต่ละรายการได้",
    ],
    tips: [
      "ควรตรวจสอบ Log ทุกครั้งเมื่อมีเหตุการณ์สำคัญที่ต้องการติดตาม",
      "หากพบข้อผิดพลาดใน Log ควรรีบทำการตรวจสอบและแก้ไขปัญหาด่วน",
    ],
  },
  {
    title: "Static Data (ข้อมูลสถิติ)",
    content:
      "Static Data ใช้สำหรับดูข้อมูลสถิติที่ถูกบันทึกไว้ล่วงหน้า เช่น จำนวนข้อความที่ส่ง, ข้อความที่ตอบกลับ หรือข้อมูลอื่น ๆ ที่เกี่ยวข้องกับการทำงานของบอท",
    steps: [
      "ไปที่เมนู **ดูข้อมูลสถิติ** หรือ **Static Data** ในแถบเมนู",
      "ในหน้านี้คุณจะเห็นข้อมูลที่ถูกบันทึกไว้ เช่น จำนวนข้อความที่ถูกส่งไปยังผู้ใช้งานในช่วงเวลาต่าง ๆ หรือสถานะการทำงานของบอท",
      "ข้อมูลเหล่านี้จะไม่เปลี่ยนแปลงและใช้สำหรับการตรวจสอบประสิทธิภาพการทำงานของบอท",
    ],
    tips: [
      "ใช้ข้อมูลจาก **Static Data** เพื่อประเมินประสิทธิภาพการทำงานของบอทและหาจุดที่สามารถปรับปรุงได้",
      "ข้อมูลสถิติจะช่วยให้คุณทราบว่าบอทมีการทำงานได้ดีแค่ไหนในช่วงเวลาต่าง ๆ",
    ],
  },
  {
    title: "การตั้งเวลาส่งข้อความ",
    content:
      "การตั้งเวลาส่งข้อความช่วยให้คุณกำหนดเวลาที่ข้อความจะถูกส่งไปยังผู้ใช้งานหรือแชทบอทในเวลาที่เหมาะสม ซึ่งช่วยให้การส่งข้อความอัตโนมัติมีความยืดหยุ่นมากขึ้น",
    steps: [
      "ไปที่เมนู **ส่งข้อความ**",
      "เลือกประเภทข้อความที่ต้องการส่ง เช่น **ข้อความทั่วไป**, **Broadcast**, หรือ **Narrowcast**",
      "กรอกเนื้อหาข้อความที่ต้องการส่ง",
      "ตั้งเวลาสำหรับการส่งข้อความ โดยระบุวันที่และเวลา",
      "กดปุ่ม **ตั้งเวลา** หรือ **ส่ง** ข้อความที่ตั้งเวลาไว้",
    ],
    tips: [
      "ตรวจสอบเวลาให้ถูกต้องก่อนกดส่งเพื่อหลีกเลี่ยงข้อผิดพลาด",
      "การตั้งเวลาส่งข้อความมีประโยชน์ในกรณีที่ต้องการส่งข้อความในเวลาที่ผู้ใช้งานสะดวก หรือส่งข้อความแจ้งเตือน",
    ],
  },
];

  const handleToggle = (index) => {
    setExpandedIndex(expandedIndex === index ? null : index);
  };

  return (
    <Container maxWidth="lg" sx={{ py: 4 }}>
      <Typography variant="h4" sx={{ fontWeight: "bold", my: 3, textAlign: "center" }}>
        Manual Middleware
      </Typography>
      <Grid container spacing={4}>
        {sections.map((section, index) => (
          <Grid item xs={12} sm={6} md={4} key={index}>
            <Card
              variant="outlined"
              sx={{
                display: "flex",
                flexDirection: "column",
                // Set height to auto so each card adjusts based on its content
                height: expandedIndex === index ? "100%" : 250, // Adjust based on expansion state
                transition: "height 1.0s ease", // Animation for expanding and collapsing
              }}
            >
              <CardContent sx={{ display: "flex", flexDirection: "column", flexGrow: 1 }}>
                <Box sx={{ display: "flex", alignItems: "center", mb: 2 }}>
                  <InfoIcon sx={{ color: "primary.main", mr: 2 }} />
                  <Typography variant="h6" sx={{ fontWeight: "bold", flexGrow: 1 }}>
                    {section.title}
                  </Typography>
                </Box>

                {section.content && (
                  <Typography
                    variant="body2"
                    sx={{
                      mb: 2,
                      overflow: "hidden",
                      textOverflow: "ellipsis",
                      display: "-webkit-box",
                      WebkitBoxOrient: "vertical",
                      WebkitLineClamp: expandedIndex === index ? "unset" : 2, // limit to 2 lines unless expanded
                    }}
                    ref={(el) => (contentRefs.current[index] = el)}
                  >
                    {section.content}
                  </Typography>
                )}

                {/* Collapse "ขั้นตอน" and "เคล็ดลับ" sections */}
                {section.steps && (
                  <Box   sx={{
                    display: expandedIndex === index ? "block" : "none",
                    transition: "opacity 1.0s ease, transform 1.0s ease",
                    opacity: expandedIndex === index ? 1 : 0,
                    transform: expandedIndex === index ? "scale(1)" : "scale(0.95)", // Make it slightly shrink when collapsed
                  }}>
                    <Typography variant="body2" color="text.secondary" sx={{ mb: 1 }}>
                      ขั้นตอน:
                    </Typography>
                    <List>
                      {section.steps.map((step, idx) => (
                        <ListItem key={idx} sx={{ pl: 0, py: 1 }}>
                          <Typography variant="body2">{`• ${step}`}</Typography>
                        </ListItem>
                      ))}
                    </List>
                  </Box>
                )}

                {section.tips && (
                  <Box   sx={{
                    display: expandedIndex === index ? "block" : "none",
                    transition: "opacity 1.0s ease, transform 1.0s ease",
                    opacity: expandedIndex === index ? 1 : 0,
                    transform: expandedIndex === index ? "scale(1)" : "scale(0.95)", // Make it slightly shrink when collapsed
                  }}>
                    <Typography variant="body2" color="text.secondary" sx={{ mt: 2, mb: 1 }}>
                      เคล็ดลับ:
                    </Typography>
                    <List>
                      {section.tips.map((tip, idx) => (
                        <ListItem key={idx} sx={{ pl: 0, py: 1 }}>
                          <Typography variant="body2">{`✓ ${tip}`}</Typography>
                        </ListItem>
                      ))}
                    </List>
                  </Box>
                )}

                {/* Show the button only if the content exceeds 2 lines */}
                {contentHeight[index] > 30 && (
                  <Button onClick={() => handleToggle(index)} sx={{ mt: 2 }}>
                    {expandedIndex === index ? "ย่อ" : "อ่านเพิ่มเติม"}
                  </Button>
                )}
              </CardContent>
            </Card>
          </Grid>
        ))}
      </Grid>
    </Container>
  );
};

export default Manual;

















// const sections = [
//   {
//     title: "ภาพรวม",
//     content:
//       "คู่มือฉบับนี้จะช่วยให้คุณตั้งค่าและจัดการแชทบอทบน Line ด้วย middleware ได้อย่างง่ายดาย โดยครอบคลุมทั้งส่วนของผู้ดูแลระบบและผู้ใช้งานทั่วไป รวมถึงวิธีตั้งค่าบอทประเภทต่าง ๆ และกำหนดข้อความตอบกลับ",
//   },
//   {
//     title: "เข้าสู่ระบบ / ลงทะเบียน",
//     content: "คุณสามารถเข้าสู่ระบบหรือสมัครสมาชิกได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
//     steps: [
//       "เปิดหน้าล็อกอินหรือหน้าลงทะเบียน",
//       "กรอกอีเมลและรหัสผ่าน (สำหรับเข้าสู่ระบบ) หรือกรอกข้อมูลที่จำเป็น (สำหรับสมัครสมาชิก)",
//       "คลิกปุ่มเข้าสู่ระบบหรือลงทะเบียน",
//       "หากสำเร็จ จะพาคุณไปยังหน้าหลัก",
//       "หากข้อมูลผิด ระบบจะแจ้งเตือนให้ลองใหม่",
//     ],
//     tips: [
//       "ตรวจสอบอีเมลและรหัสผ่านให้ถูกต้อง",
//       "ตั้งรหัสผ่านให้ปลอดภัย เช่น ตัวเลข + ตัวอักษรพิเศษ",
//       "หากลืมรหัสผ่าน ให้ใช้ตัวเลือก \"ลืมรหัสผ่าน\"",
//       "ตรวจสอบอีเมลเพื่อยืนยันตัวตน (หากระบบร้องขอ)",
//     ],
//   },
//   {
//     title: "สร้างแชทบอท",
//     content: "เชื่อบอทเข้ากับLineได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
//     steps: [
//       "ไปที่เมนูจัดการแชทบอท",
//       "กดปุ่ม \"สร้างแชทบอท\"",
//       "กรอกข้อมูลช่องทาง: ชื่อ, Channel Secret, Channel Access Token",
//       "กดบันทึก",
//     ],
//     tips: [
//       "ตรวจสอบ Token และ Secret ให้ถูกต้องก่อนบันทึก",
//       "ตั้งชื่อให้สื่อความหมายเพื่อให้ง่ายต่อการจัดการ",
//     ],
//   },
//   {
//     title: "ตั้งค่าบอท และ แก้ไขข้อความตอบกลับ",
//     content: "ในส่วนนี้คุณสามารถตั้งค่าบอทและกำหนดข้อความตอบกลับที่เหมาะสมกับการใช้งานได้:",
//     steps: [
//       "เลือกแชทบอทที่ต้องการตั้งค่า",
//       "กำหนดประเภท: ข้อความ, ปฏิกิริยา, API บอท",
//       "กำหนดพฤติกรรม เช่น ตอบกลับอัตโนมัติ, รูปแบบข้อความ",
//       "เพิ่มเงื่อนไขการตอบกลับ เช่น คำหลัก",
//       "บันทึกการตั้งค่า",
//     ],
//     tips: [
//       "ทดสอบการตั้งค่าก่อนใช้งานจริง",
//       "ใช้คำหลักให้ชัดเจนเพื่อให้การตอบกลับถูกต้อง",
//     ],
//   },
//   {
//     title: "ตั้งค่าเมนู Rich Menu",
//     content: "คุณสามารถสร้าง Rich Menu ได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
//     steps: [
//       "ไปที่แท็บ Rich Menu ในแชทบอทที่เลือก",
//       "อัปโหลดภาพเมนู (ขนาดแนะนำ: 1200x810 px)",
//       "กำหนดปุ่มกด เช่น ลิงก์, คำสั่งตอบกลับ",
//       "กดบันทึก",
//     ],
//     tips: [
//       "ใช้เมนูที่เข้าใจง่ายและชัดเจน",
//       "เพิ่มปุ่มโต้ตอบเพื่อเพิ่มการมีส่วนร่วม",
//     ],
//   },
//   {
//     title: "ส่งข้อความ",
//     content: "คุณสามารถส่งข้อความต่างๆได้อย่างง่ายดายภายในไม่กี่ขั้นตอน:",
//     steps: [
//       "ไปที่เมนูส่งข้อความ",
//       "เลือกประเภทข้อความ: ข้อความทั่วไป, Broadcast, Narrowcast",
//       "กรอกเนื้อหาข้อความ",
//       "กดส่ง",
//     ],
//   },
//   {
//     title: "การดู Log (บันทึกเหตุการณ์)",
//     content:
//       "ฟีเจอร์ Log (บันทึกเหตุการณ์) ช่วยให้คุณติดตามและตรวจสอบการกระทำต่าง ๆ ของแชทบอท เช่น การตั้งค่าบอท, การส่งข้อความ และเหตุการณ์สำคัญอื่น ๆ ที่เกิดขึ้นในระบบ",
//     steps: [
//       "ไปที่เมนู **บันทึกเหตุการณ์ (Log)** ในแถบเมนู",
//       "ในหน้านี้คุณจะเห็นบันทึกเหตุการณ์ทั้งหมดในระบบ เช่น ข้อความที่ถูกส่ง, การตั้งค่าบอทที่มีการแก้ไข หรือเหตุการณ์สำคัญต่าง ๆ",
//       "คุณสามารถคลิกเพื่อดูรายละเอียดของเหตุการณ์ในแต่ละรายการได้",
//     ],
//     tips: [
//       "ควรตรวจสอบ Log ทุกครั้งเมื่อมีเหตุการณ์สำคัญที่ต้องการติดตาม",
//       "หากพบข้อผิดพลาดใน Log ควรรีบทำการตรวจสอบและแก้ไขปัญหาด่วน",
//     ],
//   },
//   {
//     title: "Static Data (ข้อมูลสถิติ)",
//     content:
//       "Static Data ใช้สำหรับดูข้อมูลสถิติที่ถูกบันทึกไว้ล่วงหน้า เช่น จำนวนข้อความที่ส่ง, ข้อความที่ตอบกลับ หรือข้อมูลอื่น ๆ ที่เกี่ยวข้องกับการทำงานของบอท",
//     steps: [
//       "ไปที่เมนู **ดูข้อมูลสถิติ** หรือ **Static Data** ในแถบเมนู",
//       "ในหน้านี้คุณจะเห็นข้อมูลที่ถูกบันทึกไว้ เช่น จำนวนข้อความที่ถูกส่งไปยังผู้ใช้งานในช่วงเวลาต่าง ๆ หรือสถานะการทำงานของบอท",
//       "ข้อมูลเหล่านี้จะไม่เปลี่ยนแปลงและใช้สำหรับการตรวจสอบประสิทธิภาพการทำงานของบอท",
//     ],
//     tips: [
//       "ใช้ข้อมูลจาก **Static Data** เพื่อประเมินประสิทธิภาพการทำงานของบอทและหาจุดที่สามารถปรับปรุงได้",
//       "ข้อมูลสถิติจะช่วยให้คุณทราบว่าบอทมีการทำงานได้ดีแค่ไหนในช่วงเวลาต่าง ๆ",
//     ],
//   },
//   {
//     title: "การตั้งเวลาส่งข้อความ (Scheduled Messages)",
//     content:
//       "การตั้งเวลาส่งข้อความช่วยให้คุณกำหนดเวลาที่ข้อความจะถูกส่งไปยังผู้ใช้งานหรือแชทบอทในเวลาที่เหมาะสม ซึ่งช่วยให้การส่งข้อความอัตโนมัติมีความยืดหยุ่นมากขึ้น",
//     steps: [
//       "ไปที่เมนู **ส่งข้อความ**",
//       "เลือกประเภทข้อความที่ต้องการส่ง เช่น **ข้อความทั่วไป**, **Broadcast**, หรือ **Narrowcast**",
//       "กรอกเนื้อหาข้อความที่ต้องการส่ง",
//       "ตั้งเวลาสำหรับการส่งข้อความ โดยระบุวันที่และเวลา",
//       "กดปุ่ม **ตั้งเวลา** หรือ **ส่ง** ข้อความที่ตั้งเวลาไว้",
//     ],
//     tips: [
//       "ตรวจสอบเวลาให้ถูกต้องก่อนกดส่งเพื่อหลีกเลี่ยงข้อผิดพลาด",
//       "การตั้งเวลาส่งข้อความมีประโยชน์ในกรณีที่ต้องการส่งข้อความในเวลาที่ผู้ใช้งานสะดวก หรือส่งข้อความแจ้งเตือน",
//     ],
//   },
// ];